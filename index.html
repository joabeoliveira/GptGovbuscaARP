<!DOCTYPE html>
<html lang="pt-BR">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Busca ARP por CATMAT</title>
        <meta name="description" content="Consulta de atas de registro de preco por CATMAT com dados do Compras.gov.br.">

        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Fraunces:opsz,wght@9..144,600;700&family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap">
        <link rel="stylesheet" href="css/tailwind.css">
        <link rel="stylesheet" href="css/style.css">
    </head>
    <body class="bg-slate-50 text-ink dark:bg-slate-950 dark:text-slate-100">
        <a class="sr-only focus:not-sr-only focus:absolute focus:left-4 focus:top-4 focus:z-50 focus:rounded-lg focus:bg-white focus:px-4 focus:py-2 focus:text-ink" href="#main">
            Ir para conteudo principal
        </a>

        <div class="relative min-h-screen overflow-hidden">
            <div class="pointer-events-none absolute inset-0 bg-[radial-gradient(60%_60%_at_10%_10%,rgba(14,116,144,0.18),transparent_60%),radial-gradient(50%_50%_at_90%_0%,rgba(217,119,6,0.15),transparent_60%),linear-gradient(180deg,#f8fafc_0%,#ffffff_55%)] dark:bg-[radial-gradient(60%_60%_at_10%_10%,rgba(14,116,144,0.2),transparent_60%),radial-gradient(50%_50%_at_90%_0%,rgba(217,119,6,0.16),transparent_60%),linear-gradient(180deg,#0f172a_0%,#020617_60%)]"></div>

            <header class="relative border-b border-white/60 bg-white/70 backdrop-blur dark:border-white/10 dark:bg-slate-950/70">
                <nav aria-label="Principal" class="mx-auto flex max-w-6xl items-center justify-between px-6 py-4">
                    <div>
                        <p class="text-xs uppercase tracking-[0.3em] text-ocean">Busca ARP</p>
                        <h1 class="font-display text-xl font-semibold text-ink dark:text-white">Inteligencia de adesoes por CATMAT</h1>
                    </div>
                    <div class="flex items-center gap-3">
                        <button id="darkModeToggle" class="rounded-full border border-ocean/30 px-4 py-2 text-sm font-semibold text-ink transition hover:border-ocean hover:text-ocean focus:outline-none focus:ring-2 focus:ring-ocean/60 dark:text-white" type="button" aria-pressed="false">
                            Alternar modo
                        </button>
                        <a class="rounded-full bg-ink px-4 py-2 text-sm font-semibold text-white shadow-lg shadow-ink/20 transition hover:translate-y-[-1px] focus:outline-none focus:ring-2 focus:ring-ink/60 dark:bg-white dark:text-ink" href="#search">
                            Buscar ARPs
                        </a>
                    </div>
                </nav>
            </header>

            <main id="main" class="relative mx-auto max-w-6xl px-6 pb-16 pt-10">
                <section class="grid gap-8 lg:grid-cols-[1.1fr_0.9fr]">
                    <div class="reveal">
                        <p class="text-sm font-semibold uppercase tracking-[0.2em] text-ember">Compras.gov.br</p>
                        <h2 class="font-display text-4xl font-semibold text-ink dark:text-white md:text-5xl">
                            Encontre atas vigentes e oportunidades de adesao
                        </h2>
                        <p class="mt-4 text-base text-slate-600 dark:text-slate-300">
                            Pesquise por CATMAT, valide itens ativos e acompanhe limites de adesao. Os dados vem direto do modulo ARP do Portal de Dados Abertos.
                        </p>
                        <div class="mt-6 grid gap-4 sm:grid-cols-3">
                            <div class="rounded-2xl border border-white/70 bg-white/80 p-4 shadow-sm backdrop-blur dark:border-white/10 dark:bg-slate-900/60">
                                <p class="text-xs uppercase tracking-[0.2em] text-slate-500">Fonte</p>
                                <p class="mt-2 text-lg font-semibold text-ink dark:text-white">API publica</p>
                            </div>
                            <div class="rounded-2xl border border-white/70 bg-white/80 p-4 shadow-sm backdrop-blur dark:border-white/10 dark:bg-slate-900/60">
                                <p class="text-xs uppercase tracking-[0.2em] text-slate-500">Foco</p>
                                <p class="mt-2 text-lg font-semibold text-ink dark:text-white">CATMAT</p>
                            </div>
                            <div class="rounded-2xl border border-white/70 bg-white/80 p-4 shadow-sm backdrop-blur dark:border-white/10 dark:bg-slate-900/60">
                                <p class="text-xs uppercase tracking-[0.2em] text-slate-500">Saida</p>
                                <p class="mt-2 text-lg font-semibold text-ink dark:text-white">Oportunidades</p>
                            </div>
                        </div>
                    </div>
                    <div class="reveal reveal-delay-1 rounded-3xl border border-white/70 bg-white/85 p-6 shadow-xl shadow-slate-200/50 backdrop-blur dark:border-white/10 dark:bg-slate-900/70 dark:shadow-slate-950/50">
                        <h3 class="font-display text-2xl font-semibold text-ink dark:text-white">Status da consulta</h3>
                        <p class="mt-3 text-sm text-slate-600 dark:text-slate-300" id="statusText">
                            Informe o CATMAT e o periodo de vigencia para iniciar.
                        </p>
                        <div class="mt-6 grid gap-4 sm:grid-cols-2">
                            <div class="rounded-2xl border border-slate-200/80 bg-slate-50/80 p-4 dark:border-white/10 dark:bg-slate-900/60">
                                <p class="text-xs uppercase tracking-[0.2em] text-slate-500">Registros</p>
                                <p class="mt-2 text-2xl font-semibold" id="totalRegistros">0</p>
                            </div>
                            <div class="rounded-2xl border border-slate-200/80 bg-slate-50/80 p-4 dark:border-white/10 dark:bg-slate-900/60">
                                <p class="text-xs uppercase tracking-[0.2em] text-slate-500">Paginas</p>
                                <p class="mt-2 text-2xl font-semibold" id="totalPaginas">0</p>
                            </div>
                        </div>
                        <div class="mt-6 rounded-2xl border border-ember/30 bg-amber-50/80 p-4 text-sm text-amber-900 dark:border-ember/40 dark:bg-amber-950/40 dark:text-amber-100">
                            <p class="font-semibold">Dica rapida</p>
                            <p class="mt-2">Use um intervalo de datas menor para consultas mais rapidas e consistentes.</p>
                        </div>
                    </div>
                </section>

                <section id="search" class="mt-10 rounded-3xl border border-white/70 bg-white/80 p-8 shadow-xl shadow-slate-200/40 backdrop-blur dark:border-white/10 dark:bg-slate-900/70">
                    <div class="flex flex-wrap items-center justify-between gap-4">
                        <div>
                            <h3 class="font-display text-2xl font-semibold text-ink dark:text-white">Busca por CATMAT</h3>
                            <p class="mt-2 text-sm text-slate-600 dark:text-slate-300">Todos os campos com asterisco sao obrigatorios.</p>
                        </div>
                        <p class="text-xs uppercase tracking-[0.3em] text-slate-400">API ARP</p>
                    </div>

                    <form id="searchForm" class="mt-6 grid gap-6" novalidate>
                        <div class="grid gap-4 md:grid-cols-2 lg:grid-cols-4">
                            <div>
                                <label class="text-sm font-semibold text-ink dark:text-white" for="catmat">CATMAT *</label>
                                <input id="catmat" name="catmat" type="text" inputmode="numeric" autocomplete="off" placeholder="Ex: 123456" class="mt-2 w-full rounded-xl border border-slate-200/80 bg-white px-4 py-3 text-sm text-ink shadow-sm focus:border-ocean focus:outline-none focus:ring-2 focus:ring-ocean/40 dark:border-white/10 dark:bg-slate-950 dark:text-white" required>
                            </div>
                            <div>
                                <label class="text-sm font-semibold text-ink dark:text-white" for="dateMin">Vigencia inicial min *</label>
                                <input id="dateMin" name="dateMin" type="date" class="mt-2 w-full rounded-xl border border-slate-200/80 bg-white px-4 py-3 text-sm text-ink shadow-sm focus:border-ocean focus:outline-none focus:ring-2 focus:ring-ocean/40 dark:border-white/10 dark:bg-slate-950 dark:text-white" required>
                            </div>
                            <div>
                                <label class="text-sm font-semibold text-ink dark:text-white" for="dateMax">Vigencia inicial max *</label>
                                <input id="dateMax" name="dateMax" type="date" class="mt-2 w-full rounded-xl border border-slate-200/80 bg-white px-4 py-3 text-sm text-ink shadow-sm focus:border-ocean focus:outline-none focus:ring-2 focus:ring-ocean/40 dark:border-white/10 dark:bg-slate-950 dark:text-white" required>
                            </div>
                            <div>
                                <label class="text-sm font-semibold text-ink dark:text-white" for="pageSize">Itens por pagina</label>
                                <select id="pageSize" name="pageSize" class="mt-2 w-full rounded-xl border border-slate-200/80 bg-white px-4 py-3 text-sm text-ink shadow-sm focus:border-ocean focus:outline-none focus:ring-2 focus:ring-ocean/40 dark:border-white/10 dark:bg-slate-950 dark:text-white">
                                    <option value="10">10</option>
                                    <option value="20">20</option>
                                    <option value="30">30</option>
                                    <option value="40">40</option>
                                </select>
                            </div>
                            <div class="flex items-end">
                                <label class="flex w-full items-center gap-3 rounded-xl border border-slate-200/80 bg-white px-4 py-3 text-sm font-semibold text-slate-600 shadow-sm dark:border-white/10 dark:bg-slate-950 dark:text-slate-200">
                                    <input id="onlyPositive" type="checkbox" class="h-4 w-4 rounded border-slate-300 text-ocean focus:ring-ocean" />
                                    Somente com adesao > 0
                                </label>
                            </div>
                        </div>

                        <details class="rounded-2xl border border-slate-200/80 bg-slate-50/80 p-4 text-sm text-slate-700 dark:border-white/10 dark:bg-slate-950/60 dark:text-slate-200">
                            <summary class="cursor-pointer font-semibold text-ink dark:text-white">Filtros avancados</summary>
                            <div class="mt-4 grid gap-4 md:grid-cols-2 lg:grid-cols-4">
                                <div>
                                    <label class="text-xs font-semibold text-slate-500" for="orgao">Codigo UG</label>
                                    <input id="orgao" name="orgao" type="text" autocomplete="off" placeholder="Ex: 160392" class="mt-2 w-full rounded-xl border border-slate-200/80 bg-white px-3 py-2 text-sm text-ink shadow-sm focus:border-ocean focus:outline-none focus:ring-2 focus:ring-ocean/40 dark:border-white/10 dark:bg-slate-900 dark:text-white">
                                </div>
                                <div>
                                    <label class="text-xs font-semibold text-slate-500" for="numeroAta">Numero da ata</label>
                                    <input id="numeroAta" name="numeroAta" type="text" autocomplete="off" placeholder="Ex: 00001/2026" class="mt-2 w-full rounded-xl border border-slate-200/80 bg-white px-3 py-2 text-sm text-ink shadow-sm focus:border-ocean focus:outline-none focus:ring-2 focus:ring-ocean/40 dark:border-white/10 dark:bg-slate-900 dark:text-white">
                                </div>
                                <div>
                                    <label class="text-xs font-semibold text-slate-500" for="modalidade">Modalidade</label>
                                    <input id="modalidade" name="modalidade" type="text" autocomplete="off" placeholder="Ex: 05" class="mt-2 w-full rounded-xl border border-slate-200/80 bg-white px-3 py-2 text-sm text-ink shadow-sm focus:border-ocean focus:outline-none focus:ring-2 focus:ring-ocean/40 dark:border-white/10 dark:bg-slate-900 dark:text-white">
                                </div>
                                <div>
                                    <label class="text-xs font-semibold text-slate-500" for="tipoItem">Tipo item</label>
                                    <input id="tipoItem" name="tipoItem" type="text" autocomplete="off" placeholder="Ex: M" class="mt-2 w-full rounded-xl border border-slate-200/80 bg-white px-3 py-2 text-sm text-ink shadow-sm focus:border-ocean focus:outline-none focus:ring-2 focus:ring-ocean/40 dark:border-white/10 dark:bg-slate-900 dark:text-white">
                                </div>
                            </div>
                        </details>

                        <div class="grid gap-4 md:grid-cols-[1.2fr_0.8fr]">
                            <div class="rounded-2xl border border-dashed border-ember/50 bg-amber-50/60 p-4 text-sm text-amber-900 dark:bg-amber-950/30 dark:text-amber-100">
                                <p class="font-semibold">Webhook n8n (opcional)</p>
                                <p class="mt-2">Se ativado, a busca envia um resumo para seu workflow.</p>
                                <div class="mt-3 flex flex-col gap-3 sm:flex-row sm:items-center">
                                    <input id="n8nWebhook" name="n8nWebhook" type="url" placeholder="https://seu-n8n/webhook/..." class="w-full rounded-xl border border-amber-200 bg-white px-3 py-2 text-sm text-ink shadow-sm focus:border-ember focus:outline-none focus:ring-2 focus:ring-ember/40 dark:border-amber-900 dark:bg-slate-950 dark:text-white">
                                    <label class="flex items-center gap-2 text-xs font-semibold uppercase tracking-[0.2em] text-amber-700 dark:text-amber-200">
                                        <input id="n8nEnabled" type="checkbox" class="h-4 w-4 rounded border-amber-400 text-ember focus:ring-ember">
                                        Ativar
                                    </label>
                                </div>
                            </div>
                            <div class="flex flex-wrap items-center gap-3">
                                <button id="submitButton" class="rounded-full bg-ink px-6 py-3 text-sm font-semibold text-white shadow-lg shadow-ink/30 transition hover:translate-y-[-1px] focus:outline-none focus:ring-2 focus:ring-ink/60 dark:bg-white dark:text-ink" type="submit">
                                    Consultar ARPs
                                </button>
                                <button id="resetButton" class="rounded-full border border-slate-300 px-5 py-3 text-sm font-semibold text-slate-600 transition hover:border-slate-500 focus:outline-none focus:ring-2 focus:ring-slate-300 dark:border-white/20 dark:text-slate-200" type="reset">
                                    Limpar filtros
                                </button>
                            </div>
                        </div>

                        <div id="errorBox" class="hidden rounded-2xl border border-red-200 bg-red-50 px-4 py-3 text-sm text-red-900 dark:border-red-900/60 dark:bg-red-950/40 dark:text-red-100" role="alert"></div>
                    </form>
                </section>

                <section class="mt-10">
                    <div class="flex flex-wrap items-center justify-between gap-4">
                        <div>
                            <h3 class="font-display text-2xl font-semibold text-ink dark:text-white">Resultados</h3>
                            <p class="mt-2 text-sm text-slate-600 dark:text-slate-300">Clique em "Consultar saldo" para calcular o maximo permitido de adesao.</p>
                        </div>
                        <div class="rounded-full border border-slate-200 bg-white/80 px-4 py-2 text-xs font-semibold uppercase tracking-[0.2em] text-slate-500 dark:border-white/10 dark:bg-slate-900/60">
                            Dados oficiais
                        </div>
                    </div>

                    <div class="mt-6 overflow-x-auto rounded-3xl border border-white/70 bg-white/80 shadow-xl shadow-slate-200/40 backdrop-blur dark:border-white/10 dark:bg-slate-900/70">
                        <table class="min-w-full text-left text-sm">
                            <thead class="bg-slate-100/80 text-xs uppercase tracking-[0.2em] text-slate-500 dark:bg-slate-950/60 dark:text-slate-300">
                                <tr>
                                    <th class="px-4 py-3">Numero ata</th>
                                    <th class="px-4 py-3">CATMAT</th>
                                    <th class="px-4 py-3">Descricao</th>
                                    <th class="px-4 py-3">Detalhes</th>
                                    <th class="px-4 py-3">Max adesao</th>
                                    <th class="px-4 py-3">Valor unitario</th>
                                    <th class="px-4 py-3">Orgao gerenciador</th>
                                    <th class="px-4 py-3">Codigo UG</th>
                                    <th class="px-4 py-3">Fornecedor</th>
                                    <th class="px-4 py-3">Fornecedor (detalhes)</th>
                                    <th class="px-4 py-3">CNPJ</th>
                                </tr>
                            </thead>
                            <tbody id="resultsBody" class="divide-y divide-slate-200/80 dark:divide-white/10"></tbody>
                        </table>
                    </div>

                    <div class="mt-6 flex flex-wrap items-center justify-between gap-4">
                        <p class="text-sm text-slate-600 dark:text-slate-300" id="paginationInfo">Pagina 0 de 0</p>
                        <div class="flex items-center gap-2">
                            <button id="prevPage" class="rounded-full border border-slate-300 px-4 py-2 text-sm font-semibold text-slate-600 transition hover:border-slate-500 focus:outline-none focus:ring-2 focus:ring-slate-300 disabled:cursor-not-allowed disabled:opacity-50 dark:border-white/20 dark:text-slate-200" type="button">
                                Anterior
                            </button>
                            <button id="nextPage" class="rounded-full border border-slate-300 px-4 py-2 text-sm font-semibold text-slate-600 transition hover:border-slate-500 focus:outline-none focus:ring-2 focus:ring-slate-300 disabled:cursor-not-allowed disabled:opacity-50 dark:border-white/20 dark:text-slate-200" type="button">
                                Proxima
                            </button>
                        </div>
                    </div>
                </section>
            </main>

            <footer class="relative border-t border-white/60 bg-white/70 py-6 text-sm text-slate-500 backdrop-blur dark:border-white/10 dark:bg-slate-950/70 dark:text-slate-300">
                <div class="mx-auto flex max-w-6xl flex-wrap items-center justify-between gap-3 px-6">
                    <p>Dados: Compras.gov.br - modulo ARP.</p>
                    <p>Pronto para integrar com n8n e deploy via GitHub.</p>
                </div>
            </footer>
        </div>

        <div id="detailsModal" class="fixed inset-0 z-50 hidden items-center justify-center bg-slate-950/60 px-6 py-10 backdrop-blur">
            <div class="w-full max-w-3xl rounded-3xl border border-white/10 bg-white p-6 shadow-2xl dark:bg-slate-950">
                <div class="flex items-start justify-between gap-4">
                    <div>
                        <p class="text-xs uppercase tracking-[0.2em] text-slate-400">Detalhes da ata</p>
                        <h3 class="font-display text-2xl font-semibold text-ink dark:text-white">Links oficiais</h3>
                    </div>
                    <button id="closeModal" class="rounded-full border border-slate-200 px-3 py-1 text-sm font-semibold text-slate-600 hover:border-slate-400 focus:outline-none focus:ring-2 focus:ring-slate-300 dark:border-white/10 dark:text-slate-200" type="button">
                        Fechar
                    </button>
                </div>
                <div id="detailsContent" class="mt-5 space-y-4 text-sm text-slate-600 dark:text-slate-300">
                    <p>Carregando detalhes...</p>
                </div>
            </div>
        </div>

        <div id="supplierModal" class="fixed inset-0 z-50 hidden items-center justify-center bg-slate-950/60 px-6 py-10 backdrop-blur">
            <div class="w-full max-w-3xl rounded-3xl border border-white/10 bg-white p-6 shadow-2xl dark:bg-slate-950">
                <div class="flex items-start justify-between gap-4">
                    <div>
                        <p class="text-xs uppercase tracking-[0.2em] text-slate-400">Fornecedor</p>
                        <h3 class="font-display text-2xl font-semibold text-ink dark:text-white">Detalhes do CNPJ</h3>
                    </div>
                    <button id="closeSupplier" class="rounded-full border border-slate-200 px-3 py-1 text-sm font-semibold text-slate-600 hover:border-slate-400 focus:outline-none focus:ring-2 focus:ring-slate-300 dark:border-white/10 dark:text-slate-200" type="button">
                        Fechar
                    </button>
                </div>
                <div id="supplierContent" class="mt-5 space-y-4 text-sm text-slate-600 dark:text-slate-300">
                    <p>Carregando detalhes...</p>
                </div>
            </div>
        </div>

        <script type="module" src="js/main.js" defer></script>
    </body>
</html>
